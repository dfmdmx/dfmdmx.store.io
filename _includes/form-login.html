<!-- ---------includes--------- -->
{% include messages.html %}
<!-- ---------includes--------- -->

<style>
.form-login {
  margin-bottom: 20px;
}
</style>

<div class='form-login'>

  <p id="message-text"></p>

  <form class="pure-form login">

      <fieldset class="pure-group">
          <input name="email" type="email" class="pure-input-1-2" placeholder="Correo electr칩nico" >
          <input name="password" type="password" class="pure-input-1-2" placeholder="Contrase침a" >
      </fieldset>

      <button type="submit" class="pure-button pure-input-1-2 pure-button-primary">Entrar <i class="fas fa-sign-in-alt"></i></button>
      <div class="g-signin2" data-onsuccess="onSignIn"></div>
  </form>
  <br>
  <a class="u-email" href="/change-password"><i class="far fa-envelope"></i> Cambiar constrase침a</a><br>

</div>

<a href="/signin" class="pure-button pure-button-primary">Abrir cuenta <i class="fas fa-users"></i></a>

<script src="https://www.google.com/recaptcha/api.js?render={{ site.data.callback.captchakey }}"></script>

<script>

$( ".login" ).on('submit', function( event ) {
  event.preventDefault();
  {%- if jekyll.environment == 'production' -%}
  grecaptcha.ready(function() {
      grecaptcha.execute("{{ site.data.callback.captchakey }}", {action: 'form_login'}).then(function(token) {
  {%- else -%}
  var token = 'dummy';
  {%- endif -%}
         var method = 'form_login';
         var args = $( ".login" ).serializeFormJSON();
         args['token'] = token;
         remoteCall(method,args).done(function(response){
           var session_token = response.session_token;
           setCookie('session_token', session_token, 2);
           window.location.replace("/");
         }).fail(function(){
           messageAlert('Las credenciales son inv치lidas.');
         });

  {%- if jekyll.environment == 'production' -%}
      });
  });
  {%- endif -%}

});

google_user = $.Deferred()
google_id_token = $.Deferred()

function onSignIn(googleUser) {
  var id_token = googleUser.getAuthResponse().id_token;
  var profile = googleUser.getBasicProfile();
  console.log(profile);
  console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
  console.log('Name: ' + profile.getName());
  console.log('Image URL: ' + profile.getImageUrl());
  console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
}

</script>
