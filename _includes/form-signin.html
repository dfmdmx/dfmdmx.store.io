<!-- ---------includes--------- -->
{% include messages.html %}
<!-- ---------includes--------- -->

<style>
.form-signin {
  margin-bottom: 20px;
}
.overdoingthings {
  font-family: 'Inconsolata', monospace;
  font-size: 16px;
}
</style>

<div class='form-signin'>
  <p id="message-text"></p>
  <form class="pure-form signin">
      <fieldset class="pure-group">
          <legend class="pure-input-1-2" >Usuario</legend>
          <input name="name" type="text" class="pure-input-1-2" placeholder="Nombre" >
          <input name="email" type="email" class="pure-input-1-2" placeholder="Correo electrónico" >
          <input name="password" type="password" class="pure-input-1-2" placeholder="Contraseña" >
          <small><b class="overdoingthings">*</b>  Mínimo ocho caracteres.</small><br>
          <small><b class="overdoingthings">*</b>  No uses la misma contraseña que en el banco o correo.</small><br>
      </fieldset>
  <small><b>Atención: </b><br>Al registrarte estarás aceptando los <a href='#'>Términos y Condiciones.</a></small><br>
      <button type="submit" class="pure-button pure-input-1-2 pure-button-primary">Registrar <i class="fas fa-users"></i></button>
  </form>
  <br>
  <div class='pure-g pure-form'>
    <div class='pure-u-1-2'>
      <fieldset class="pure-group">
        <legend class="pure-u-1-2" >Métodos alternos</legend>
        <div class="g-signin2" data-onsuccess="onSignIn"></div>
      </fieldset>
    </div>
  </div>
  <br>
  <small><b class="overdoingthings">No</b>  almacenamos datos bancarios.</small><br>
  <small><b class="overdoingthings">No</b>  enviamos correos con anuncios.</small><br>
  <small><b class="overdoingthings">Si</b>  contestamos correos con dudas.</small><br>
  <br>
  <a class="u-email" href="mailto:{{ site.email }}"><i class="far fa-envelope"></i> {{ site.email }}</a><br>
</div>

<script src="https://www.google.com/recaptcha/api.js?render={{ site.data.callback.captchakey }}"></script>
<script>

  gapi.load('auth2', function() {
    gapi.auth2.init({"client_id":"19912403518-umth3iha0k0qltfeul122n08u49q9pjs.apps.googleusercontent.com"});
  });

  $( ".signin" ).on('submit', function( event ) {
    event.preventDefault();
    {%- if jekyll.environment == 'production' -%}
    grecaptcha.ready(function() {
        grecaptcha.execute("{{ site.data.callback.captchakey }}", {action: 'form_signin'}).then(function(token) {
    {%- else -%}
    var token = 'dummy';
    {%- endif -%}
           var method = 'form_signin';
           var args = $( ".signin" ).serializeFormJSON();
           args['token'] = token;
           console.log(args);
           remoteCall(method,args).done(function(response){
             window.location.replace("/login");
           }).fail(function(){
             messageAlert('Error: Puede que el correo ya este registrado.');
           });

    {%- if jekyll.environment == 'production' -%}
        });
    });
    {%- endif -%}

  });

  function onSignIn(googleUser) {

    {%- if jekyll.environment == 'production' -%}
    grecaptcha.ready(function() {
        grecaptcha.execute("{{ site.data.callback.captchakey }}", {action: 'google_login'}).then(function(token) {
    {%- else -%}
    var token = 'dummy';
    {%- endif -%}

    var id_token = googleUser.getAuthResponse().id_token;
    var profile = googleUser.getBasicProfile();
    console.log(profile);
    var method = 'google_login';
    var args = {'token':token,'id_token':id_token};
    remoteCall(method,args).done(function(response){
      var session_token = response.session_token;
      console.log('session_token');
      setCookie('session_token', session_token, 2);
      window.location.replace("/");
    }).fail(function(){
      messageAlert('Las credenciales son inválidas.');
    });

    {%- if jekyll.environment == 'production' -%}
        });
    });
    {%- endif -%}

  }

</script>
